
create procedure [dbo].[sp_MemberLoan_RptGetall]
	@LoanCode int=null,
	@MemberCode int=null,
	@LoanNameCode int=null,
	@Fromdate Datetime,
	@ToDate Datetime
	
as
	select * from vw_memberloan
	where loancode=ISNULL(@loancode,loancode) and
	Membercode=ISNULL(@MemberCode,MemberCode) and
	LoanNamecode=ISNULL(@LoanNameCode,LoanNameCode) and
	LoanDate>=@Fromdate and LoanDate<=@Todate

GO


ALTER VIEW [dbo].[vw_MemberLoan]
AS
SELECT     dbo.tbl_MemberLoan.LoanCode, dbo.tbl_MemberLoan.MemberCode, dbo.tbl_Member.Number, dbo.tbl_Member.EmployeeNumber, dbo.tbl_Member.MemberName, 
                      dbo.tbl_Member.MemberName_Tamil, dbo.tbl_Member.MemberType, dbo.tbl_MemberLoan.LoanNamecode, dbo.tbl_LoanName.LoanName, 
                      dbo.tbl_MemberLoan.LoanNumber,CONVERT(varchar(50),dbo.tbl_MemberLoan.LoanNumber) as StrLoanNumber, dbo.tbl_MemberLoan.LoanDate, dbo.tbl_MemberLoan.ROI, dbo.tbl_MemberLoan.LoanAmount, dbo.tbl_MemberLoan.LoanPeriod, 
                      dbo.tbl_MemberLoan.LastPaidDate, dbo.tbl_MemberLoan.Emi_Amount, dbo.tbl_MemberLoan.paymode, dbo.tbl_MemberLoan.LoanOutStanding, 
                      dbo.tbl_MemberLoan.Principal, dbo.tbl_MemberLoan.ODPrincipal, dbo.tbl_MemberLoan.Interest, dbo.tbl_MemberLoan.ODInterest
FROM         dbo.tbl_MemberLoan LEFT OUTER JOIN
                      dbo.tbl_LoanName ON dbo.tbl_MemberLoan.LoanNamecode = dbo.tbl_LoanName.LoanNameCode LEFT OUTER JOIN
                      dbo.tbl_Member ON dbo.tbl_MemberLoan.MemberCode = dbo.tbl_Member.MemberCode

GO


GO

ALTER PROCEDURE [dbo].[sp_Member_GetAll]
(@MemberCode bigint = null, @Status bit = null,@EmployeeNumber int=null,@Companycode int=null,
 @Staff INT=0,@Worker INT=0,@Other INT=0)
AS
delete From tbl_MemberReport 
if @Staff =1
BEGIN
	insert into tbl_MemberReport
	SELECT     MemberCode, Number, EmployeeNumber, TDOpening,ShareOpening, CONVERT(varchar, EmployeeNumber) AS strEmpNo, MemberName,MemberName_Tamil,MemberType, Status,
	Photo_Image,Address1,Address2,Address3,Address4,Address_Tamil1,Address_Tamil2,Address_Tamil3,Address_Tamil4,MobileNo
	FROM         tbl_Member
	WHERE   MemberCode = ISNULL(@MemberCode,MemberCode) AND Status = ISNULL(@Status,Status) AND EmployeeNumber=isnull(@EmployeeNumber,EmployeeNumber)
	--and membercode not in (select MemberCode from tbl_TDClossing)
	and (MemberType='STAFF')
	ORDER BY MEMBERCODE
END

if @WORKER =1
BEGIN
	insert into tbl_MemberReport
	SELECT     MemberCode, Number, EmployeeNumber, TDOpening,ShareOpening, CONVERT(varchar, EmployeeNumber) AS strEmpNo, MemberName,MemberName_Tamil,MemberType, Status,
	Photo_Image,Address1,Address2,Address3,Address4,Address_Tamil1,Address_Tamil2,Address_Tamil3,Address_Tamil4,MobileNo
	FROM         tbl_Member
	WHERE   MemberCode = ISNULL(@MemberCode,MemberCode) AND Status = ISNULL(@Status,Status) AND EmployeeNumber=isnull(@EmployeeNumber,EmployeeNumber)
	--and membercode not in (select MemberCode from tbl_TDClossing)
	and (MemberType='WORKERS')
	ORDER BY MEMBERCODE
END

if @OTHER =1
BEGIN
	insert into tbl_MemberReport
	SELECT     MemberCode, Number, EmployeeNumber, TDOpening,ShareOpening, CONVERT(varchar, EmployeeNumber) AS strEmpNo, MemberName,MemberName_Tamil,MemberType, Status,
	Photo_Image,Address1,Address2,Address3,Address4,Address_Tamil1,Address_Tamil2,Address_Tamil3,Address_Tamil4,MobileNo
	FROM         tbl_Member
	WHERE   MemberCode = ISNULL(@MemberCode,MemberCode) AND Status = ISNULL(@Status,Status) AND EmployeeNumber=isnull(@EmployeeNumber,EmployeeNumber)
	--and membercode not in (select MemberCode from tbl_TDClossing)
	and (MemberType='OTHER' OR MemberType IS NULL)
	ORDER BY MEMBERCODE
END

IF @STAFF=1 OR @Worker=1 OR @Other=1 
BEGIN
	SELECT     MemberCode, Number, EmployeeNumber, TDOpening,ShareOpening, CONVERT(varchar, EmployeeNumber) AS strEmpNo, MemberName,MemberName_Tamil,MemberType, Status,
	Photo_Image,Address1,Address2,Address3,Address4,Address_Tamil1,Address_Tamil2,Address_Tamil3,Address_Tamil4,MobileNo
	FROM         tbl_MemberREPORT
	WHERE   MemberCode = ISNULL(@MemberCode,MemberCode) AND Status = ISNULL(@Status,Status) AND EmployeeNumber=isnull(@EmployeeNumber,EmployeeNumber)

END
ELSE

BEGIN
	SELECT     MemberCode, Number, EmployeeNumber, TDOpening,ShareOpening, CONVERT(varchar, EmployeeNumber) AS strEmpNo, MemberName,MemberName_Tamil,MemberType, Status,
	Photo_Image,Address1,Address2,Address3,Address4,Address_Tamil1,Address_Tamil2,Address_Tamil3,Address_Tamil4,MobileNo
	FROM         tbl_Member
	WHERE   MemberCode = ISNULL(@MemberCode,MemberCode) AND 
			Status = ISNULL(@Status,Status) AND 
			EmployeeNumber=isnull(@EmployeeNumber,EmployeeNumber) 
--	and membercode not in (select MemberCode from tbl_TDClossing)
END



GO
